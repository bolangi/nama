#!/usr/bin/env perl 
use warnings;
while(<>){ s/#([^!].*|$)//gm; print}

# pound followed by newline or something not bang
